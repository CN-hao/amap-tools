import{d as F,r as f,o as H,a as M,c as N,b as E,e as x,f as D,g as X,h as O,w as p,t as T,_ as Y,i as z,E as k,j as W,k as m,l as S}from"./index-CfQL1lZp.js";const j={class:"map-container",id:"map-container"},U={class:"name"},G={class:"address"},J=F({__name:"index",props:{autoComplete:{type:Boolean,default:!1},resize:{type:Boolean,default:!0},autoCompleteDisabled:{type:Boolean,default:!1},autoComplatePlaceholder:{default:"搜索地点..."}},emits:["resize","init","select"],setup(I,{expose:r,emit:g}){const A=I,n=f("");let s=null;const C=f(!1),_=f(0),V=f(0),w=f(0),B=f(0),P=f(0),y=f(null);H(()=>{AMap.plugin(["AMap.MoveAnimation","AMap.MouseTool","AMap.PlaceSearch","AMap.AutoComplete","AMap.CircleEditor"],function(){s=new window.AMap.Map("myMap",{center:[103.797477,30.08692],zoom:13}),new AMap.PlaceSearch({pageSize:5,pageIndex:1,citylimit:!0,map:s,panel:"panel",autoFitView:!0}),A.autoComplete&&(y.value=new AMap.AutoComplete({city:"全国",type:"地点"})),d("init",s);const e=document.getElementById("map-container");e&&(w.value=e.offsetLeft,e.getBoundingClientRect(),P.value=e.offsetHeight)})});const b=(e,l)=>{if(!e){l([]);return}y.value.search(e,(v,u)=>{if(v==="complete"&&u.tips){const L=u.tips.map(c=>({...c,value:c.name,name:c.name,address:c.district+c.address,location:c.location,id:c.id}));console.log(L),l(L.filter(({location:c})=>c))}else l([])})},o=e=>{d("select",e),n.value=""},t=e=>{C.value=!0,_.value="touches"in e?e.touches[0].clientX:e.clientX,V.value="touches"in e?e.touches[0].clientY:e.clientY,document.addEventListener("mousemove",a),document.addEventListener("mouseup",i)},a=e=>{if(!C.value)return;const l="touches"in e?e.touches[0].clientX:e.clientX,v="touches"in e?e.touches[0].clientY:e.clientY,u=l-_.value,L=v-V.value,c=document.getElementById("map-container");if(c){const R=Math.max(w.value+u,0),$=Math.min(B.value-L,P.value);c.style.left=R+"px",c.style.bottom=$+"px"}},i=()=>{C.value=!1;const e=document.getElementById("map-container");var l=e.offsetParent,v=l.getBoundingClientRect(),u=e.getBoundingClientRect();v.bottom-u.bottom,w.value=e?.offsetLeft||0,document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",i),B.value=0,e.style.bottom=0,d("resize",{left:w.value,bottom:B.value,height:u.height})},h=()=>{n.value=""},d=g;return r({map:s,querySearch:b,handleSelect:o,clearInput:h}),(e,l)=>{const v=M("el-autocomplete");return E(),N("div",j,[l[2]||(l[2]=x("div",{id:"myMap"},null,-1)),e.resize?(E(),N("div",{key:0,class:"resize-icon",onMousedown:t,onTouchstart:t},l[1]||(l[1]=[x("svg",{t:"1749453106330",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"990",width:"200",height:"200"},[x("path",{d:"M389.20009955 708.01898549L170.96683732 926.25224651H356.65540741v103.56306254H-5.81530905V667.34459259h103.56306254v185.68857009l218.23326102-218.2591526 73.21908504 73.27086577z m-65.0893843-310.68918518L97.74775349 170.96683732V356.65540741H-5.81530905V-5.81530905h362.47071646v103.56306254h-185.68857009l226.36296299 226.36296176-73.21908506 73.21908506z m284.79842016-55.45801956L853.03316268 97.74775349H667.34459259V-5.81530905h362.47071646v362.47071646h-103.56306254v-185.68857009l-244.12402726 244.14991884-73.21908384-73.27086699z m81.34878459 275.14116384L926.25224651 853.03316268V667.34459259h103.56306254v362.47071646H667.34459259v-103.56306254h185.68857009l-236.02021809-235.99432651 73.24497541-73.24497541z",fill:"#1296db","p-id":"991"})],-1)]),32)):D("",!0),y.value?(E(),X(v,{key:1,modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=u=>n.value=u),"fetch-suggestions":b,placeholder:e.autoComplatePlaceholder,disabled:e.autoCompleteDisabled,"popper-append-to-body":"false","popper-class":"map-search-autocomplete",onSelect:o},{default:p(({item:u})=>[x("div",U,T(u.name),1),x("div",G,T(u.address),1)]),_:1},8,["modelValue","placeholder","disabled"])):D("",!0),O(e.$slots,"default",{},void 0,!0)])}}}),q=Y(J,[["__scopeId","data-v-a047d53c"]]),K={__name:"AmpTools",setup(I){let r=z([]);const g=f(""),A=z({}),n=new AMap.Polyline({isOutline:!0,outlineColor:"#ffeeee",borderWeight:1,strokeColor:"#3366FF",strokeOpacity:1,strokeWeight:3,strokeStyle:"solid",lineJoin:"round"});n.on("click",()=>{const o=n.getLength();k.alert(`路线总长${o}米`,"提示",{confirmButtonText:"确  定",type:"info"})});let s=null;const C=o=>{s=o,s.on("click",_),s.on("rightclick",w),s.add(n)},_=o=>{const t=[o.lnglat.lng,o.lnglat.lat];let a=new AMap.Marker({position:t,map:s,draggable:!0});a.setLabel({direction:"top",offset:new AMap.Pixel(10,0),content:"<div>关键点</div>"}),s.setFitView(),a.on("click",async()=>{await k.confirm("确认要删除该关键点吗？","提示",{confirmButtonText:"确  定",cancelButtonText:"取  消",type:"warning"}),s.remove(a),n.setPath(n.getPath().filter(i=>i.toString()!==t.toString())),r.splice(r.indexOf(a),1)}),a.on("dragging",function(i){const h=a.getPosition();n.setPath(n.getPath().map(d=>d.toString()===t.toString()?h:d)),t[0]=h.lng,t[1]=h.lat,r.push({}),r.pop()}),r.push(z(a)),n.setPath([...n.getPath()||[],t]),n.show()},V=o=>{const{location:t,name:a,address:i}=o;t.lng,t.lat,_({lnglat:t})},w=o=>{if(r.length===0){k.alert("请先添加关键点","提示",{confirmButtonText:"确  定",type:"warning"});return}y()},B=()=>{k.confirm("确认要重置所有关键点吗？","提示",{confirmButtonText:"确  定",cancelButtonText:"取  消",type:"warning"}).then(()=>{P()})},P=()=>{r.forEach(o=>s.remove(o)),r.length=0;try{n.setPath([]),n.hide()}catch{}g.value=""};W(r,o=>{y(),A.length=n.getLength()},{deep:!0});const y=()=>{g.value=r.map(o=>{const t=o.getPosition();return`${t.lng},${t.lat};`}).join("")},b=()=>{if(g.value===""){k.alert("请先填入经纬度","提示",{confirmButtonText:"确  定",type:"warning"});return}const o=g.value.split(";").filter(t=>t.trim()!=="");P(),o.forEach(t=>{const[a,i]=t.split(",").map(Number);!isNaN(a)&&!isNaN(i)&&_({lnglat:{lng:a,lat:i}})})};return H(()=>{}),(o,t)=>{const a=M("el-input"),i=M("el-col"),h=M("el-button"),d=M("el-row"),e=M("el-card");return E(),X(q,{class:"main-container",onInit:C,autoComplatePlaceholder:"搜索关键词添加关键点",autoComplete:!0,onSelect:V,resize:!1},{default:p(()=>[m(d,{class:"inner"},{default:p(()=>[m(d,{style:{width:"100%"},gutter:10},{default:p(()=>[m(i,{span:16},{default:p(()=>[m(a,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=l=>g.value=l),placeholder:"请先选择关键点或填入经纬度"},null,8,["modelValue"])]),_:1}),m(i,{span:4},{default:p(()=>[m(h,{onClick:b},{default:p(()=>t[1]||(t[1]=[S("绘制")])),_:1,__:[1]})]),_:1}),m(i,{span:4},{default:p(()=>[m(h,{onClick:B},{default:p(()=>t[2]||(t[2]=[S("重置")])),_:1,__:[2]})]),_:1})]),_:1}),m(d,{style:{width:"100%","margin-top":"10px"}},{default:p(()=>[m(e,{style:{width:"100%"}},{header:p(()=>t[3]||(t[3]=[S(" 路线信息 ")])),default:p(()=>[S(" 总长度："+T(A.length||0)+" 米 ",1)]),_:1})]),_:1})]),_:1})]),_:1})}}},Z=Y(K,[["__scopeId","data-v-e5aad7c9"]]);export{Z as default};
