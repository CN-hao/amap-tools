import{d as O,r as m,o as Y,a as y,c as I,b as L,e as x,f as D,g as R,h as W,w as u,t as E,_ as $,i as H,j as X,E as b,k as g,l as z}from"./index-TPqomO16.js";const j={class:"map-container",id:"map-container"},U={class:"name"},G={class:"address"},J=O({__name:"index",props:{autoComplete:{type:Boolean,default:!1},resize:{type:Boolean,default:!0},autoCompleteDisabled:{type:Boolean,default:!1},autoComplatePlaceholder:{default:"搜索地点..."}},emits:["resize","init","select"],setup(T,{expose:r,emit:f}){const M=T,n=m("");let l=null;const C=m(!1),B=m(0),V=m(0),_=m(0),P=m(0),w=m(0),o=m(null);Y(()=>{AMap.plugin(["AMap.MoveAnimation","AMap.MouseTool","AMap.PlaceSearch","AMap.AutoComplete","AMap.CircleEditor"],function(){l=new window.AMap.Map("myMap",{center:[103.797477,30.08692],zoom:13}),new AMap.PlaceSearch({pageSize:5,pageIndex:1,citylimit:!0,map:l,panel:"panel",autoFitView:!0}),M.autoComplete&&(o.value=new AMap.AutoComplete({city:"全国",type:"地点"})),k("init",l);const e=document.getElementById("map-container");e&&(_.value=e.offsetLeft,e.getBoundingClientRect(),w.value=e.offsetHeight)})});const t=(e,a)=>{if(!e){a([]);return}o.value.search(e,(v,c)=>{if(v==="complete"&&c.tips){const A=c.tips.map(i=>({...i,value:i.name,name:i.name,address:i.district+i.address,location:i.location,id:i.id}));console.log(A),a(A.filter(({location:i})=>i))}else a([])})},s=e=>{k("select",e),n.value=""},d=e=>{C.value=!0,B.value="touches"in e?e.touches[0].clientX:e.clientX,V.value="touches"in e?e.touches[0].clientY:e.clientY,document.addEventListener("mousemove",h),document.addEventListener("mouseup",p)},h=e=>{if(!C.value)return;const a="touches"in e?e.touches[0].clientX:e.clientX,v="touches"in e?e.touches[0].clientY:e.clientY,c=a-B.value,A=v-V.value,i=document.getElementById("map-container");if(i){const F=Math.max(_.value+c,0),N=Math.min(P.value-A,w.value);i.style.left=F+"px",i.style.bottom=N+"px"}},p=()=>{C.value=!1;const e=document.getElementById("map-container");var a=e.offsetParent,v=a.getBoundingClientRect(),c=e.getBoundingClientRect();v.bottom-c.bottom,_.value=e?.offsetLeft||0,document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",p),P.value=0,e.style.bottom=0,k("resize",{left:_.value,bottom:P.value,height:c.height})},S=()=>{n.value=""},k=f;return r({map:l,querySearch:t,handleSelect:s,clearInput:S}),(e,a)=>{const v=y("el-autocomplete");return L(),I("div",j,[a[2]||(a[2]=x("div",{id:"myMap"},null,-1)),e.resize?(L(),I("div",{key:0,class:"resize-icon",onMousedown:d,onTouchstart:d},a[1]||(a[1]=[x("svg",{t:"1749453106330",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"990",width:"200",height:"200"},[x("path",{d:"M389.20009955 708.01898549L170.96683732 926.25224651H356.65540741v103.56306254H-5.81530905V667.34459259h103.56306254v185.68857009l218.23326102-218.2591526 73.21908504 73.27086577z m-65.0893843-310.68918518L97.74775349 170.96683732V356.65540741H-5.81530905V-5.81530905h362.47071646v103.56306254h-185.68857009l226.36296299 226.36296176-73.21908506 73.21908506z m284.79842016-55.45801956L853.03316268 97.74775349H667.34459259V-5.81530905h362.47071646v362.47071646h-103.56306254v-185.68857009l-244.12402726 244.14991884-73.21908384-73.27086699z m81.34878459 275.14116384L926.25224651 853.03316268V667.34459259h103.56306254v362.47071646H667.34459259v-103.56306254h185.68857009l-236.02021809-235.99432651 73.24497541-73.24497541z",fill:"#1296db","p-id":"991"})],-1)]),32)):D("",!0),o.value?(L(),R(v,{key:1,modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=c=>n.value=c),"fetch-suggestions":t,placeholder:e.autoComplatePlaceholder,disabled:e.autoCompleteDisabled,"popper-append-to-body":"false","popper-class":"map-search-autocomplete",onSelect:s},{default:u(({item:c})=>[x("div",U,E(c.name),1),x("div",G,E(c.address),1)]),_:1},8,["modelValue","placeholder","disabled"])):D("",!0),W(e.$slots,"default",{},void 0,!0)])}}}),q=$(J,[["__scopeId","data-v-a047d53c"]]),K={__name:"AmpTools",setup(T){let r=H([]);const f=m(""),M=H({});X(f,o=>{f.value===""?M.length=0:M.length=n.getLength()},{immediate:!0});const n=new AMap.Polyline({isOutline:!0,outlineColor:"#ffeeee",borderWeight:1,strokeColor:"#3366FF",strokeOpacity:1,strokeWeight:3,strokeStyle:"solid",lineJoin:"round"});n.on("click",()=>{const o=n.getLength();b.alert(`路线总长${o}米`,"提示",{confirmButtonText:"确  定",type:"info"})});let l=null;const C=o=>{l=o,l.on("click",B),l.on("rightclick",_),l.add(n)},B=o=>{const t=[o.lnglat.lng,o.lnglat.lat];let s=new AMap.Marker({position:t,map:l,draggable:!0});s.setLabel({direction:"top",offset:new AMap.Pixel(10,0),content:"<div>关键点</div>"}),l.setFitView(),s.on("click",async()=>{await b.confirm("确认要删除该关键点吗？","提示",{confirmButtonText:"确  定",cancelButtonText:"取  消",type:"warning"}),l.remove(s),n.setPath(n.getPath().filter(d=>d.toString()!==t.toString())),r.splice(r.indexOf(s),1)}),s.on("dragend",function(d){const h=s.getPosition();n.setPath(n.getPath().map(p=>p.toString()===t.toString()?h:p)),t[0]=h.lng,t[1]=h.lat,w()}),r.push(s),n.setPath([...n.getPath()||[],t]),n.show()},V=o=>{const{location:t,name:s,address:d}=o;t.lng,t.lat,B({lnglat:t})},_=()=>{if(r.length===0){b.alert("请先添加关键点","提示",{confirmButtonText:"确  定",type:"warning"});return}w()},P=()=>{b.confirm("确认要重置所有关键点吗？","提示",{confirmButtonText:"确  定",cancelButtonText:"取  消",type:"warning"}).then(()=>{r.forEach(o=>l.remove(o)),r.length=0;try{n.setPath([]),n.hide()}catch{}f.value=""})};X(r,o=>{w()});const w=()=>{f.value=r.map(o=>{const t=o.getPosition();return`${t.lng},${t.lat};`}).join("")};return Y(()=>{}),(o,t)=>{const s=y("el-input"),d=y("el-col"),h=y("el-button"),p=y("el-row"),S=y("el-card");return L(),R(q,{class:"main-container",onInit:C,autoComplatePlaceholder:"搜索关键词添加关键点",autoComplete:!0,onSelect:V,resize:!1},{default:u(()=>[g(p,{class:"inner"},{default:u(()=>[g(p,{gutter:10},{default:u(()=>[g(d,{span:20},{default:u(()=>[g(s,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=k=>f.value=k),placeholder:"请先选择关键点",readonly:""},null,8,["modelValue"])]),_:1}),g(d,{span:3},{default:u(()=>[g(h,{onClick:P},{default:u(()=>t[1]||(t[1]=[z("重置")])),_:1,__:[1]})]),_:1})]),_:1}),g(p,{style:{width:"100%"}},{default:u(()=>[g(S,{style:{width:"100%"}},{header:u(()=>t[2]||(t[2]=[z(" 路线信息 ")])),default:u(()=>[z(" 总长度："+E(M.length||0)+" 米 ",1)]),_:1})]),_:1})]),_:1})]),_:1})}}},Z=$(K,[["__scopeId","data-v-51dac5a7"]]);export{Z as default};
