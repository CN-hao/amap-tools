import{d as O,r as g,o as X,a as M,c as I,b as E,e as k,f as N,g as Y,h as W,w as u,t as z,_ as $,i as D,j as H,E as V,k as f,l as S}from"./index-kTz7Rp0g.js";const j={class:"map-container",id:"map-container"},U={class:"name"},G={class:"address"},J=O({__name:"index",props:{autoComplete:{type:Boolean,default:!1},resize:{type:Boolean,default:!0},autoCompleteDisabled:{type:Boolean,default:!1},autoComplatePlaceholder:{default:"搜索地点..."}},emits:["resize","init","select"],setup(T,{expose:p,emit:d}){const C=T,n=g("");let i=null;const B=g(!1),w=g(0),b=g(0),y=g(0),P=g(0),x=g(0),v=g(null);X(()=>{AMap.plugin(["AMap.MoveAnimation","AMap.MouseTool","AMap.PlaceSearch","AMap.AutoComplete","AMap.CircleEditor"],function(){i=new window.AMap.Map("myMap",{center:[103.797477,30.08692],zoom:13}),new AMap.PlaceSearch({pageSize:5,pageIndex:1,citylimit:!0,map:i,panel:"panel",autoFitView:!0}),C.autoComplete&&(v.value=new AMap.AutoComplete({city:"全国",type:"地点"})),m("init",i);const e=document.getElementById("map-container");e&&(y.value=e.offsetLeft,e.getBoundingClientRect(),x.value=e.offsetHeight)})});const A=(e,l)=>{if(!e){l([]);return}v.value.search(e,(_,r)=>{if(_==="complete"&&r.tips){const L=r.tips.map(c=>({...c,value:c.name,name:c.name,address:c.district+c.address,location:c.location,id:c.id}));console.log(L),l(L.filter(({location:c})=>c))}else l([])})},o=e=>{m("select",e),n.value=""},t=e=>{B.value=!0,w.value="touches"in e?e.touches[0].clientX:e.clientX,b.value="touches"in e?e.touches[0].clientY:e.clientY,document.addEventListener("mousemove",a),document.addEventListener("mouseup",s)},a=e=>{if(!B.value)return;const l="touches"in e?e.touches[0].clientX:e.clientX,_="touches"in e?e.touches[0].clientY:e.clientY,r=l-w.value,L=_-b.value,c=document.getElementById("map-container");if(c){const R=Math.max(y.value+r,0),F=Math.min(P.value-L,x.value);c.style.left=R+"px",c.style.bottom=F+"px"}},s=()=>{B.value=!1;const e=document.getElementById("map-container");var l=e.offsetParent,_=l.getBoundingClientRect(),r=e.getBoundingClientRect();_.bottom-r.bottom,y.value=e?.offsetLeft||0,document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",s),P.value=0,e.style.bottom=0,m("resize",{left:y.value,bottom:P.value,height:r.height})},h=()=>{n.value=""},m=d;return p({map:i,querySearch:A,handleSelect:o,clearInput:h}),(e,l)=>{const _=M("el-autocomplete");return E(),I("div",j,[l[2]||(l[2]=k("div",{id:"myMap"},null,-1)),e.resize?(E(),I("div",{key:0,class:"resize-icon",onMousedown:t,onTouchstart:t},l[1]||(l[1]=[k("svg",{t:"1749453106330",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"990",width:"200",height:"200"},[k("path",{d:"M389.20009955 708.01898549L170.96683732 926.25224651H356.65540741v103.56306254H-5.81530905V667.34459259h103.56306254v185.68857009l218.23326102-218.2591526 73.21908504 73.27086577z m-65.0893843-310.68918518L97.74775349 170.96683732V356.65540741H-5.81530905V-5.81530905h362.47071646v103.56306254h-185.68857009l226.36296299 226.36296176-73.21908506 73.21908506z m284.79842016-55.45801956L853.03316268 97.74775349H667.34459259V-5.81530905h362.47071646v362.47071646h-103.56306254v-185.68857009l-244.12402726 244.14991884-73.21908384-73.27086699z m81.34878459 275.14116384L926.25224651 853.03316268V667.34459259h103.56306254v362.47071646H667.34459259v-103.56306254h185.68857009l-236.02021809-235.99432651 73.24497541-73.24497541z",fill:"#1296db","p-id":"991"})],-1)]),32)):N("",!0),v.value?(E(),Y(_,{key:1,modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=r=>n.value=r),"fetch-suggestions":A,placeholder:e.autoComplatePlaceholder,disabled:e.autoCompleteDisabled,"popper-append-to-body":"false","popper-class":"map-search-autocomplete",onSelect:o},{default:u(({item:r})=>[k("div",U,z(r.name),1),k("div",G,z(r.address),1)]),_:1},8,["modelValue","placeholder","disabled"])):N("",!0),W(e.$slots,"default",{},void 0,!0)])}}}),q=$(J,[["__scopeId","data-v-a047d53c"]]),K={__name:"AmpTools",setup(T){let p=D([]);const d=g(""),C=D({});H(d,o=>{d.value===""?C.length=0:C.length=n.getLength()},{immediate:!0});const n=new AMap.Polyline({isOutline:!0,outlineColor:"#ffeeee",borderWeight:1,strokeColor:"#3366FF",strokeOpacity:1,strokeWeight:3,strokeStyle:"solid",lineJoin:"round"});n.on("click",()=>{const o=n.getLength();V.alert(`路线总长${o}米`,"提示",{confirmButtonText:"确  定",type:"info"})});let i=null;const B=o=>{i=o,i.on("click",w),i.on("rightclick",y),i.add(n)},w=o=>{const t=[o.lnglat.lng,o.lnglat.lat];let a=new AMap.Marker({position:t,map:i,draggable:!0});a.setLabel({direction:"top",offset:new AMap.Pixel(10,0),content:"<div>关键点</div>"}),i.setFitView(),a.on("click",async()=>{await V.confirm("确认要删除该关键点吗？","提示",{confirmButtonText:"确  定",cancelButtonText:"取  消",type:"warning"}),i.remove(a),n.setPath(n.getPath().filter(s=>s.toString()!==t.toString())),p.splice(p.indexOf(a),1)}),a.on("dragend",function(s){const h=a.getPosition();n.setPath(n.getPath().map(m=>m.toString()===t.toString()?h:m)),t[0]=h.lng,t[1]=h.lat,v()}),p.push(a),n.setPath([...n.getPath()||[],t]),n.show()},b=o=>{const{location:t,name:a,address:s}=o;t.lng,t.lat,w({lnglat:t})},y=()=>{if(p.length===0){V.alert("请先添加关键点","提示",{confirmButtonText:"确  定",type:"warning"});return}v()},P=()=>{V.confirm("确认要重置所有关键点吗？","提示",{confirmButtonText:"确  定",cancelButtonText:"取  消",type:"warning"}).then(()=>{x()})},x=()=>{p.forEach(o=>i.remove(o)),p.length=0;try{n.setPath([]),n.hide()}catch{}d.value=""};H(p,o=>{v()});const v=()=>{d.value=p.map(o=>{const t=o.getPosition();return`${t.lng},${t.lat};`}).join("")},A=()=>{if(d.value===""){V.alert("请先填入经纬度","提示",{confirmButtonText:"确  定",type:"warning"});return}const o=d.value.split(";").filter(t=>t.trim()!=="");x(),o.forEach(t=>{const[a,s]=t.split(",").map(Number);!isNaN(a)&&!isNaN(s)&&(console.log(`添加关键点：lng=${a}, lat=${s}`),w({lnglat:{lng:a,lat:s}}))})};return X(()=>{}),(o,t)=>{const a=M("el-input"),s=M("el-col"),h=M("el-button"),m=M("el-row"),e=M("el-card");return E(),Y(q,{class:"main-container",onInit:B,autoComplatePlaceholder:"搜索关键词添加关键点",autoComplete:!0,onSelect:b,resize:!1},{default:u(()=>[f(m,{class:"inner"},{default:u(()=>[f(m,{style:{width:"100%"},gutter:10},{default:u(()=>[f(s,{span:16},{default:u(()=>[f(a,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=l=>d.value=l),placeholder:"请先选择关键点或填入经纬度"},null,8,["modelValue"])]),_:1}),f(s,{span:4},{default:u(()=>[f(h,{onClick:A},{default:u(()=>t[1]||(t[1]=[S("绘制")])),_:1,__:[1]})]),_:1}),f(s,{span:4},{default:u(()=>[f(h,{onClick:P},{default:u(()=>t[2]||(t[2]=[S("重置")])),_:1,__:[2]})]),_:1})]),_:1}),f(m,{style:{width:"100%","margin-top":"10px"}},{default:u(()=>[f(e,{style:{width:"100%"}},{header:u(()=>t[3]||(t[3]=[S(" 路线信息 ")])),default:u(()=>[S(" 总长度："+z(C.length||0)+" 米 ",1)]),_:1})]),_:1})]),_:1})]),_:1})}}},Z=$(K,[["__scopeId","data-v-cfb46c6d"]]);export{Z as default};
