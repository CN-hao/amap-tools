import{d as X,r as u,o as I,c as A,a as m,b as E,e as Y,f as F,w as V,g as b,t as T,h as x,_ as $,i as N,j,k,l as O,E as B}from"./index-BzvxO-Pr.js";const W={class:"map-container",id:"map-container"},U={class:"name"},G={class:"address"},J=X({__name:"index",props:{autoComplete:{type:Boolean,default:!1},resize:{type:Boolean,default:!0},autoCompleteDisabled:{type:Boolean,default:!1},autoComplatePlaceholder:{default:"搜索地点..."}},emits:["resize","init","select"],setup(z,{expose:r,emit:v}){const l=z,s=u("");let f=null;const g=u(!1),_=u(0),M=u(0),w=u(0),o=u(0),t=u(0),n=u(null);I(()=>{AMap.plugin(["AMap.MoveAnimation","AMap.MouseTool","AMap.PlaceSearch","AMap.AutoComplete","AMap.CircleEditor"],function(){f=new window.AMap.Map("myMap",{center:[103.797477,30.08692],zoom:13}),new AMap.PlaceSearch({pageSize:5,pageIndex:1,citylimit:!0,map:f,panel:"panel",autoFitView:!0}),l.autoComplete&&(n.value=new AMap.AutoComplete({city:"全国",type:"地点"})),P("init",f);const e=document.getElementById("map-container");e&&(w.value=e.offsetLeft,e.getBoundingClientRect(),t.value=e.offsetHeight)})});const d=(e,a)=>{if(!e){a([]);return}n.value.search(e,(h,c)=>{if(h==="complete"&&c.tips){const C=c.tips.map(i=>({...i,value:i.name,name:i.name,address:i.district+i.address,location:i.location,id:i.id}));console.log(C),a(C.filter(({location:i})=>i))}else a([])})},p=e=>{P("select",e),s.value=""},y=e=>{g.value=!0,_.value="touches"in e?e.touches[0].clientX:e.clientX,M.value="touches"in e?e.touches[0].clientY:e.clientY,document.addEventListener("mousemove",L),document.addEventListener("mouseup",S)},L=e=>{if(!g.value)return;const a="touches"in e?e.touches[0].clientX:e.clientX,h="touches"in e?e.touches[0].clientY:e.clientY,c=a-_.value,C=h-M.value,i=document.getElementById("map-container");if(i){const H=Math.max(w.value+c,0),R=Math.min(o.value-C,t.value);i.style.left=H+"px",i.style.bottom=R+"px"}},S=()=>{g.value=!1;const e=document.getElementById("map-container");var a=e.offsetParent,h=a.getBoundingClientRect(),c=e.getBoundingClientRect();h.bottom-c.bottom,w.value=e?.offsetLeft||0,document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",S),o.value=0,e.style.bottom=0,P("resize",{left:w.value,bottom:o.value,height:c.height})},D=()=>{s.value=""},P=v;return r({map:f,querySearch:d,handleSelect:p,clearInput:D}),(e,a)=>{const h=b("el-autocomplete");return x(),A("div",W,[a[2]||(a[2]=m("div",{id:"myMap"},null,-1)),e.resize?(x(),A("div",{key:0,class:"resize-icon",onMousedown:y,onTouchstart:y},a[1]||(a[1]=[m("svg",{t:"1749453106330",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"990",width:"200",height:"200"},[m("path",{d:"M389.20009955 708.01898549L170.96683732 926.25224651H356.65540741v103.56306254H-5.81530905V667.34459259h103.56306254v185.68857009l218.23326102-218.2591526 73.21908504 73.27086577z m-65.0893843-310.68918518L97.74775349 170.96683732V356.65540741H-5.81530905V-5.81530905h362.47071646v103.56306254h-185.68857009l226.36296299 226.36296176-73.21908506 73.21908506z m284.79842016-55.45801956L853.03316268 97.74775349H667.34459259V-5.81530905h362.47071646v362.47071646h-103.56306254v-185.68857009l-244.12402726 244.14991884-73.21908384-73.27086699z m81.34878459 275.14116384L926.25224651 853.03316268V667.34459259h103.56306254v362.47071646H667.34459259v-103.56306254h185.68857009l-236.02021809-235.99432651 73.24497541-73.24497541z",fill:"#1296db","p-id":"991"})],-1)]),32)):E("",!0),n.value?(x(),Y(h,{key:1,modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=c=>s.value=c),"fetch-suggestions":d,placeholder:e.autoComplatePlaceholder,disabled:e.autoCompleteDisabled,"popper-append-to-body":"false","popper-class":"map-search-autocomplete",onSelect:p},{default:V(({item:c})=>[m("div",U,T(c.name),1),m("div",G,T(c.address),1)]),_:1},8,["modelValue","placeholder","disabled"])):E("",!0),F(e.$slots,"default",{},void 0,!0)])}}}),q=$(J,[["__scopeId","data-v-a047d53c"]]),K={class:"inner"},Q={style:{"margin-top":"10px"}},Z={__name:"AmpTools",setup(z){let r=N([]);const v=u(""),l=new AMap.Polyline({isOutline:!0,outlineColor:"#ffeeee",borderWeight:1,strokeColor:"#3366FF",strokeOpacity:1,strokeWeight:3,strokeStyle:"solid",lineJoin:"round"});let s=null;const f=o=>{s=o,s.on("click",g),s.on("rightclick",M),s.add(l),l.on("click",()=>{B.alert("点击折线，事件待处理","提示",{confirmButtonText:"确  定",type:"info"})})},g=o=>{const t=[o.lnglat.lng,o.lnglat.lat];let n=new AMap.Marker({position:t,map:s,draggable:!0});n.setLabel({direction:"top",offset:new AMap.Pixel(10,0),content:"<div>关键点</div>"}),s.setFitView(),n.on("click",async()=>{await B.confirm("确认要删除该关键点吗？","提示",{confirmButtonText:"确  定",cancelButtonText:"取  消",type:"warning"}),s.remove(n),l.setPath(l.getPath().filter(d=>d.toString()!==t.toString())),r.splice(r.indexOf(n),1)}),n.on("dragend",function(d){const p=n.getPosition();l.setPath(l.getPath().map(y=>y.toString()===t.toString()?p:y)),t[0]=p.lng,t[1]=p.lat}),r.push(n),l.setPath([...l.getPath()||[],t]),l.show()},_=o=>{const{location:t,name:n,address:d}=o;t.lng,t.lat,g({lnglat:t})},M=()=>{if(r.length===0){B.alert("请先添加关键点","提示",{confirmButtonText:"确  定",type:"warning"});return}v.value=r.map(o=>{const t=o.getPosition();return`${t.lng},${t.lat};`}).join(`
`)},w=()=>{B.confirm("确认要重置所有关键点吗？","提示",{confirmButtonText:"确  定",cancelButtonText:"取  消",type:"warning"}).then(()=>{r.forEach(o=>s.remove(o)),r.length=0;try{l.setPath([]),l.hide()}catch{}v.value=""})};return j(r,o=>{v.value=o.map(t=>{const n=t.getPosition();return`${n.lng},${n.lat};`}).join(`
`)}),I(()=>{}),(o,t)=>{const n=b("el-input"),d=b("el-button");return x(),A("div",null,[k(q,{class:"main-container",onInit:f,autoComplatePlaceholder:"搜索关键词添加关键点",autoComplete:!0,onSelect:_,resize:!1},{default:V(()=>[m("div",K,[m("div",null,[k(n,{rows:5,autosize:{minRows:5,maxRows:10},modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=p=>v.value=p),"show-word-limit":!0,type:"textarea",placeholder:"请先选择关键点",readonly:""},null,8,["modelValue"])]),m("div",Q,[k(d,{onClick:w},{default:V(()=>t[1]||(t[1]=[O("重置")])),_:1,__:[1]})])])]),_:1})])}}},te=$(Z,[["__scopeId","data-v-6400c415"]]);export{te as default};
